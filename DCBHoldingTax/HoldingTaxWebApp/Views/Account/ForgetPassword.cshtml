@model HoldingTaxWebApp.Models.Users.ChangePassword
@{
    Layout = null;
}
<!DOCTYPE html>

<html lang="en">
<!--begin::Head-->
<head>
    <base href="../../../../">
    <meta charset="utf-8" />
    <title>গৃহসেবা</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!--begin::Fonts-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" />
    <!--end::Fonts-->
    <!--begin::Page Custom Styles(used by this page)-->
    <link href="~/Theme/dist/assets/css/pages/login/login-3.css" rel="stylesheet" type="text/css" />
    <!--end::Page Custom Styles-->
    <!--begin::Global Theme Styles(used by all pages)-->
    <link href="~/Theme/dist/assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
    <link href="~/Theme/dist/assets/plugins/custom/prismjs/prismjs.bundle.css" rel="stylesheet" type="text/css" />
    <link href="~/Theme/dist/assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
    <!--end::Global Theme Styles-->
    <!--begin::Layout Themes(used by all pages)-->
    <!--end::Layout Themes-->
    <link rel="shortcut icon" href="~/Images/dcb_logo_ico_.ico" />
    <style>
        .error {
            color: red !important;
            font-weight: 500 !important;
        }
    </style>
</head>
<!--end::Head-->
<!--begin::Body-->
<body id="kt_body" class="header-fixed header-mobile-fixed subheader-enabled page-loading">
    <div class="d-flex flex-column flex-root">
        <div class="login login-3 wizard d-flex flex-column flex-lg-row flex-column-fluid">

            <div class="login-content flex-row-fluid d-flex flex-column p-10">
                <div class="d-flex flex-row-fluid flex-center min-w-md-auto">
                    @*<img src="~/Images/Cantonment-Dhaka4login.png" />*@
                    <img style="width:-webkit-fill-available;" src="~/Images/dcb_4_eng_bn.png" />
                </div>
                <div class="d-flex flex-row-fluid flex-center">

                    <div class="login-form">
                        <br />
                        <!-- Modal-->
                        <div class="modal fade" id="exampleModalCustomScrollable" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-scrollable" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">পাসওয়ার্ড পরিবর্তন</h5>
                                    </div>
                                    <div class="modal-body" style="background-color:#f3f5f9">
                                        @using (Html.BeginForm("ForgetPassword", "Account", null, FormMethod.Post, new { @class = "kt-form", @id = "kt_login2", role = "form", novalidate = "novalidate" }))
                                        {
                                            @Html.AntiForgeryToken();
                                            @Html.HiddenFor(m => m.LogInCredentialId)
                                            @Html.HiddenFor(m => m.UserName)
                                            <div data-scroll="true" data-height="350">
                                                <div>
                                                    @if (TempData["PM"] != null)
                                                    {
                                                        <h5 style="color:red !important">  @TempData["PM"]</h5>
                                                    }
                                                    @if (TempData["EM"] != null)
                                                    {
                                                        <h5 style="color:red !important">  @TempData["EM"]</h5>
                                                    }
                                                    <div class="form-group">
                                                        <div class="d-flex justify-content-between mt-n5">
                                                            <label class="font-size-h6 font-weight-bolder text-dark pt-5">নুতুন পাসওয়ার্ড</label>
                                                        </div>
                                                        <input class="form-control h-auto py-7 px-6 rounded-lg border-0" type="password" name="HashPassword" autocomplete="off" required id="HashPassword" />
                                                    </div>
                                                    <div class="form-group">
                                                        <div class="d-flex justify-content-between mt-n5">
                                                            <label class="font-size-h6 font-weight-bolder text-dark pt-5">কনফার্ম পাসওয়ার্ড</label>
                                                        </div>
                                                        <input class="form-control h-auto py-7 px-6 rounded-lg border-0" type="password" name="ConfirmPassword" autocomplete="off" required id="ConfirmPassword" />
                                                    </div>


                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-light-primary font-weight-bold" data-dismiss="modal">বাতিল করুন</button>
                                                    <button type="submit" class="btn btn-primary font-weight-bold">সাবমিট করুন</button>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>







                        @*<form class="form" id="kt_login" action="">*@
                        @using (Html.BeginForm("ForgetPassword", "Account", null, FormMethod.Post, new { @class = "kt-form", @id = "kt_login", role = "form", novalidate = "novalidate" }))
                        {
                            <div class="pb-5 pb-lg-2">
                                <h4 class="font-weight-bolder text-danger font-size-h2 font-size-h1-lg">পাসওয়ার্ড পরিবর্তন করুন</h4>
                            </div>


                            <h5 style="color:red !important"> @Html.ValidationSummary(true, "", new { @class = "text-danger" })</h5>
                            if (TempData["PM"] != null)
                            {
                                <h5 style="color:red !important">  @TempData["PM"]</h5>
                            }

                            <div class="form-group">
                                <label class="font-size-h6 font-weight-bolder text-dark">ইউজারনেইম</label>
                                <input class="form-control h-auto py-7 px-6 rounded-lg border-0" type="text" name="UserName1" autocomplete="off" required id="UserName1" />
                               

                            </div>
                            <div class="pb-lg-0 pb-5">
                                <span id="SendOTP" class="btn btn-bg-primary" style="color:white">ওটিপি পাঠান</span> <span id="timer"></span>
                                <p class="font-size-h6 font-weight-bolder text-dark" id="msg"></p>
                            </div>

                            <div class="form-group">
                                <div class="d-flex justify-content-between mt-n5">
                                    <label class="font-size-h6 font-weight-bolder text-dark pt-5">ওয়ান টাইম পাসওয়ার্ড</label>
                                </div>
                                <input class="form-control h-auto py-7 px-6 rounded-lg border-0" type="text" name="otp" autocomplete="off" required id="otp" />
                            </div>
                            @*<div class="form-group">
                <div class="d-flex justify-content-between mt-n5">
                    <label class="font-size-h6 font-weight-bolder text-dark pt-5">নুতুন পাসওয়ার্ড</label>
                </div>
                <input class="form-control h-auto py-7 px-6 rounded-lg border-0" type="text" name="HashPassword" autocomplete="off" required id="HashPassword" />
            </div>
            <div class="form-group">
                <div class="d-flex justify-content-between mt-n5">
                    <label class="font-size-h6 font-weight-bolder text-dark pt-5">কনফার্ম পাসওয়ার্ড</label>
                </div>
                <input class="form-control h-auto py-7 px-6 rounded-lg border-0" type="text" name="ConfirmPassword" autocomplete="off" required id="ConfirmPassword" />
            </div>*@
                            <div class="pb-lg-0 pb-5">
                                <button type="button" class="btn btn-primary font-weight-bolder" id="btnCheckOtp">ওটিপি চেক করুন</button>
                                <a class="" href="~/Account/LogIn">
                                    LogIn
                                </a>
                            </div>
                        }
                        @*</form>*@
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>var KTAppSettings = { "breakpoints": { "sm": 576, "md": 768, "lg": 992, "xl": 1200, "xxl": 1200 }, "colors": { "theme": { "base": { "white": "#ffffff", "primary": "#0BB783", "secondary": "#E5EAEE", "success": "#1BC5BD", "info": "#8950FC", "warning": "#FFA800", "danger": "#F64E60", "light": "#F3F6F9", "dark": "#212121" }, "light": { "white": "#ffffff", "primary": "#D7F9EF", "secondary": "#ECF0F3", "success": "#C9F7F5", "info": "#EEE5FF", "warning": "#FFF4DE", "danger": "#FFE2E5", "light": "#F3F6F9", "dark": "#D6D6E0" }, "inverse": { "white": "#ffffff", "primary": "#ffffff", "secondary": "#212121", "success": "#ffffff", "info": "#ffffff", "warning": "#ffffff", "danger": "#ffffff", "light": "#464E5F", "dark": "#ffffff" } }, "gray": { "gray-100": "#F3F6F9", "gray-200": "#ECF0F3", "gray-300": "#E5EAEE", "gray-400": "#D6D6E0", "gray-500": "#B5B5C3", "gray-600": "#80808F", "gray-700": "#464E5F", "gray-800": "#1B283F", "gray-900": "#212121" } }, "font-family": "Poppins" };</script>
    <script src="~/Theme/dist/assets/plugins/global/plugins.bundle.js"></script>
    <script src="~/Theme/dist/assets/plugins/custom/prismjs/prismjs.bundle.js"></script>
    <script src="~/Theme/dist/assets/js/scripts.bundle.js"></script>
    <script src="~/Scripts/jquery.validate.js"></script>
    <script>
        jQuery(document).ready(function () {
            $("#kt_login").validate({
                rules: {
                    UserName1: {
                        required: true
                    },
                    otp: {
                        required: true
                    },
                    //HashPassword: {
                    //    required: true
                    //},
                    //ConfirmPassword: {
                    //    required: true,
                    //    equalTo: "#HashPassword"
                    //},
                },
                messages: {
                    UserName: "ঘরটি অবশ্যই পূরণ করতে হবে",
                    otp: "ঘরটি অবশ্যই পূরণ করতে হবে",
                    //HashPassword: "ঘরটি অবশ্যই পূরণ করতে হবে",
                    //ConfirmPassword: "ঘরটি অবশ্যই পূরণ করতে হবে"
                },
                invalidHandler: function (event, validator) {
                    KTUtil.scrollTop();
                }
            });

            $("#kt_login2").validate({
                rules: {

                    HashPassword: {
                        required: true
                    },
                    ConfirmPassword: {
                        required: true,
                        equalTo: "#HashPassword"
                    },
                },
                messages: {

                    HashPassword: "ঘরটি অবশ্যই পূরণ করতে হবে",
                    ConfirmPassword: "আপনার পাসওয়ার্ড মিলছে না"
                },
                invalidHandler: function (event, validator) {
                    KTUtil.scrollTop();
                }
            });

            //$('#UserName').change(function () {





            //})



            $('#SendOTP').click(function () {


                var UserName = $('#UserName1').val().trim();
                debugger;
                if (UserName !== '') {

                    debugger;
                    var data = {
                        UserName: UserName
                    }
                    $.ajax({
                        type: 'POST',
                        url: '/Account/UserNameCheck',
                        data: JSON.stringify(data),
                        contentType: 'application/json',
                        success: function (d) {
                            debugger;
                            if (d == "Success") {
                                $('#msg').html('আপনার মোবাইল নাম্বারে OTP প্রেরণ করা হয়েছে।সর্বোচ্চ ৫ (পাঁচ) মিনিটের মধ্যে OTP পেয়ে যাবেন। অনুগ্রহপূর্বক অপেক্ষা করুন। OTP পাওয়ার ৫ (পাঁচ) মিনিটের মধ্যে ব্যবহার করতে হবে। OTP না পেলে বা মেয়াদ উত্তীর্ণ হয়ে গেলে পুনরায় চেষ্টা করুন।');
                                timer(300);

                            }
                            else if (d == "Mobile No Not Found") {
                                swal.fire({
                                    "icon": 'error',
                                    "title": 'মোবাইল নাম্বার খুঁজে পাওয়া যায়নি। দয়াকরে এডমিনের সাথে যোগাযোগ করুন। ',
                                    "timer": 5000
                                });
                            }
                            else {
                                swal.fire({
                                    "icon": 'error',
                                    "title": 'ইউজার নাম ভুল। দয়াকরে পুনরায় সঠিক ইউজার নাম দিয়ে চেষ্টা করুন।',
                                    "timer": 5000
                                });
                            }

                        },
                        error: function (error) {
                            console.log(error);

                        }
                    });
                }
                else {
                    swal.fire({
                        "icon": 'error',
                        "title": 'দয়াকরে পুনরায় সঠিক ইউজার নাম দিয়ে চেষ্টা করুন।',
                        "timer": 5000
                    });
                }

              




            });





            $('#btnCheckOtp').click(function () {

                var otp = $('#otp').val();
                debugger;
                if (otp !== "") {
                    var data = {
                        otp: otp
                    }

                    $.ajax({
                        type: 'POST',
                        url: '/Account/getOtp',
                        data: JSON.stringify(data),
                        contentType: 'application/json',
                        success: function (d) {

                            if (d.Otp == otp) {
                                $("#exampleModalCustomScrollable").modal('show');
                                $("#LogInCredentialId").val(d.LogInCredentialId);
                                $("#UserName").val(d.UserName);


                            }
                            else {
                                swal.fire({
                                    "icon": 'error',
                                    "title": 'আপনার প্রদত্ত ওটিপি টি ভুল।  দয়াকরে সঠিক ওটিপি টি প্রদান করুন অথবা পুনরায় চেষ্টা করুন।',
                                    "timer": 5000
                                });
                            }

                        },
                        error: function (error) {

                            swal.fire({
                                "icon": 'error',
                                "title": 'আপনার প্রদত্ত ওটিপি টি ভুল।  দয়াকরে সঠিক ওটিপি টি প্রদান করুন অথবা পুনরায় চেষ্টা করুন।',
                                "timer": 5000
                            });
                            console.log(error);

                        }
                    });
                }
                else {
                    swal.fire({
                        "icon": 'error',
                        "title": 'দয়াকরে ওটিপি টি প্রদান',
                        "timer": 5000
                    });
                }








            });



            let timerOn = true;

            function timer(remaining) {
                debugger;
                var m = Math.floor(remaining / 60);
                var s = remaining % 60;

                m = m < 10 ? '0' + m : m;
                s = s < 10 ? '0' + s : s;
                document.getElementById('timer').innerHTML = m + ':' + s;
                remaining -= 1;

                if (remaining >= 0 && timerOn) {
                    setTimeout(function () {
                        timer(remaining);
                    }, 1000);
                    return;
                }

                if (!timerOn) {
                    // Do validate stuff here
                    return;
                }

                // Do timeout stuff here
                //alert('Timeout for otp');
                swal.fire({
                    "icon": 'error',
                    "title": 'আপনার ওটিপির মেয়াদ শেষ। নুতুন করে আবার ওটিপি পাঠান। ',
                    "timer": 4000
                });
                setTimeout(function () { location.reload(); }, 3000);


            }











        });






    </script>
</body>
<!--end::Body-->
</html>