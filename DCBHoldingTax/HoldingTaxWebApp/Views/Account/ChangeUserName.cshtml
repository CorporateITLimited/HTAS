@using HoldingTaxWebApp.Helpers

@{
    ViewBag.Title = "ChangeUserName";
}



<div class="subheader py-2 py-lg-6 subheader-transparent" id="kt_subheader">
    <div class="container d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
        <div class="d-flex align-items-center flex-wrap mr-1">
            <div class="d-flex align-items-baseline flex-wrap mr-5">
                <h5 class="text-dark font-weight-bold my-1 mr-5">ইউজারনেইম</h5>
                <ul class="breadcrumb breadcrumb-transparent breadcrumb-dot font-weight-bold p-0 my-2 font-size-sm">
                    <li class="breadcrumb-item text-muted">
                        <a href="#" class="text-muted">ইউজারনেইম পরিবর্তন</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="d-flex align-items-center">
            <a onclick="return goBack();" class="btn btn-light-primary font-weight-bolder btn-sm"><i class="fas fa-arrow-left"></i>আগের পেজে যান</a>
        </div>
    </div>
</div>


<div class="d-flex flex-column-fluid">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="card card-custom gutter-b example example-compact">
                    <div class="card-header">
                        <div class="row">
                            <h3 class="card-title">
                                <b class="kt-font-brand"> @Session[CommonConstantHelper.UserName].ToString()   &nbsp; </b>  &nbsp; এর ইউজারনেইম পরিবর্তন
                            </h3>

                            <div class="card-toolbar">
                                <div class="example-tools justify-content-center">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body align-items-center">
                        <div class="col-md-12">
                            <label>নতুন ইউজারনেইম:</label>

                            <div class="col-md-5">@Html.Editor("NewUserName", new { htmlAttributes = new { @class = "form-control", @name = "newUserName", @id = "newUserName", placeholder = "নতুন ইউজারনেইম লিখুন " } })</div>
                            <div id="message" style="color:darkred"></div>
                            <br />
                            <div class="col-md-5 float-left"><button class="btn btn-primary" id="submit">হালনাগাদ করুন</button></div>

                        </div>

                    </div>

                    <div class="card-footer">
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

@section scripts{

    <script>
        function checkUsername(){
            var data = {
                            newUserName: $('#newUserName').val()
                        }

                        $.ajax({
                            type: 'POST',
                            url: '@Url.Action("checkDuplicateUsername", "Account")',
                            data: JSON.stringify(data),
                            contentType: 'application/json',
                            success: function (d) {
                                if (d === true) {
                                    
                                    $('#message').html("*** ব্যবহারকারীর নাম আগে থেকেই আছে. অন্য একটি চেষ্টা করুন")
                                }
                                else if (d === false) {
                                    //$('#message').html("Username Ok")
                                }
                                else {
                                    $('#message').html("সিস্টেম সমস্যা")
                                }
                            },
                            error: function (error) {
                                console.log(error);
                            }
                        });
        }
        $(document).ready(function () {
            $('#newUserName').change(function () {
                
                checkUsername();   
            })


            $("#submit").click(function (e) {
                var data = {
                    newUserName: $('#newUserName').val()
                };
                $.ajax({
                            type: 'POST',
                            url: '@Url.Action("checkDuplicateUsername", "Account")',
                            data: JSON.stringify(data),
                            contentType: 'application/json',
                            success: function (d) {
                                if (d === true) {
                                    
                                    $('#message').html("*** ব্যবহারকারীর নাম আগে থেকেই আছে । অন্য একটি চেষ্টা করুন")
                                }
                                else if (d === false) {
                                    //$('#message').html("Username Ok")
                                    $('#message').html("")
                                    Swal.fire({
                                        title: "নতুন ইউজারনেইম : " + $('#newUserName').val() + " করতে চান ?",
                                        text: " ",
                                        icon: "warning",

                                        showCancelButton: true,
                                        confirmButtonText: "হ্যাঁ",
                                        cancelButtonText: "না, বাতিল!",
                                        reverseButtons: true
                                    }).then(function (result) {
                                        if (result.value) {
                                            $.ajax({
                                                    type: 'POST',
                                                    url: '@Url.Action("jsonChangeUsername", "Account")',
                                                    data: JSON.stringify(data),
                                                    contentType: 'application/json',
                                                success: function (d) {
                                                    if (d = true) {
                                                        Swal.fire(
                                                            "সম্পন্ন",
                                                            "পরিবর্তন করা হয়েছে",
                                                            "success")
                                                    }
                                                    else {
                                                        Swal.fire(
                                                            "অসুম্পর্ণ",
                                                            "পরিবর্তন করা যায়নি ",
                                                            "error")
                                                    }
                                                }
                                            })
                                            
                                            
                                            
                                        } else if (result.dismiss === "cancel") {
                                            Swal.fire(
                                                "বাতিল",
                                                "বাতিল  করা হয়েছে",
                                                "error"
                                            )
                                        }
                                    });
                                }
                                else {
                                    $('#message').html("সিস্টেম সমস্যা")
                                }
                            },
                            error: function (error) {
                                console.log(error);
                            }
                });

            });
        });
    </script>

}
